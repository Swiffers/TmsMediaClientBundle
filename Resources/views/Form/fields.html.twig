{% extends 'form_div_layout.html.twig' %}

{% block related_to_many_media_widget %}
    {% spaceless %}
        {{ block('collection_widget') }}
    {% endspaceless %}

    <script type="text/javascript">
        var collectionHolder = $('.tms_media_client__related_to_many_media');
        var $addMediaLink = $('<a href="#" class="btn btn-default add_media_link">Add media</a>');
        var $newLink = $('<div></div>').append($addMediaLink);

        jQuery(document).ready(function() {
            collectionHolder.append($newLink);

            $addMediaLink.on('click', function(e) {
                e.preventDefault();
                addMediaForm(collectionHolder, $newLink);
            });

            collectionHolder.find('.tms_media_client__related_to_one_media').each(function() {
                addMediaFormDeleteLink($(this));
            });
        });

        function addMediaForm(collectionHolder, $newLink) {
            var prototype = collectionHolder.attr('data-prototype');
            var newForm = prototype.replace(/__name__/g, collectionHolder.children().length);
            var $newFormDiv = $('<div></div>').append(newForm);
            $newLink.before($newFormDiv);
            addMediaFormDeleteLink($newFormDiv);
        }

        function addMediaFormDeleteLink($mediaFormDiv) {
            var $removeFormA = $('<a href="#" class="btn btn-default">Delete media</a>');
            $mediaFormDiv.append($removeFormA);

            $removeFormA.on('click', function(e) {
                e.preventDefault();
                $mediaFormDiv.remove();
            });
        }
    </script>
{% endblock %}

{% block related_to_one_media_widget %}
    {% spaceless %}
    <div {{ block('widget_container_attributes') }}>
        {% if data and data.url %}
            <img src="{{ data.url }}" alt="{{ data }}" title="{{ data }}" />
        {% endif %}
        {% if form.parent is empty %}
            {{ form_errors(form) }}
        {% endif %}
        {{ block('form_rows') }}
        {{ form_rest(form) }}
    </div>
    {% endspaceless %}
{% endblock %}

{% block tms_media_upload_widget %}
    {% if data and data.url %}
        <img src="{{ data.url }}?resize=1&height=150" alt="{{ data }}" title="{{ data }}" />
    {% endif %}
    {% spaceless %}
        {{ block('collection_widget') }}
    {% endspaceless %}
    <script type="text/javascript">
        $('document').ready(function() {
            $inputFile = $('#{{ id }}_uploadedFile');
            $inputFile.on('change', function(event) {
                console.log('TODO: start upload');
            });
        });
    </script>
{% endblock %}
